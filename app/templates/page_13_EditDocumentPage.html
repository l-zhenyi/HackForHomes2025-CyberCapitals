{% extends 'base.html' %}
{% block title %}Edit Document{% endblock %}
{% block content %}

<h1 class="title-purple-text text-center mt-5">Edit Document</h1>

<div class="container mt-4 member-timetable-page shadow">
    <form method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- File Upload -->
        <div class="d-flex flex-column align-items-center mt-3 mb-5">
            <h4 class="mb-3 upload-title"><strong>Choose File</strong></h4>
            <div class="input-group shadow-sm">
                <input type="file" class="form-control" name="upload_document" id="fileUpload">
            </div>
            {% if document.file %}
            <p class="text-muted mt-2">Current File:
                <a href="{{ url_for('static', filename='uploads/' + document.file) }}" target="_blank">
                    {{ document.file }}
                </a>
            </p>
            {% endif %}
        </div>

        <!-- Document Name and Upload Date -->
        <div class="row mb-5">
            <h4 class="mb-2 upload-title"><strong>Document Name</strong></h4>
            <div class="input-group shadow-sm w-75">
                <input type="text" class="form-control form-control-sm" name="document_name"
                        value="{{ document.document_name }}" required>
            </div>
        </div>
        <div class="row mb-5">    
            <h4 class="mb-2 upload-title"><strong>Date Uploaded</strong></h4>
            <div class="input-group shadow-sm w-75">
                <!-- Removed readonly to allow editing of the upload date -->
                <input type="date" class="form-control form-control-sm" name="upload_date"
                    value="{{ document.upload_date.strftime('%Y-%m-%d') }}">
            </div>
        </div>
        

        <!-- Document Type and Notes -->
        <div class="row mb-5">
            <h4 class="upload-title"><strong>Document Type</strong></h4>
            <select class="form-select shadow-sm w-75" name="document_type" required>
                <option value="identity" {% if document.document_type == "identity" %}selected{% endif %}>Identity Document</option>
                <option value="income_proof" {% if document.document_type == "income_proof" %}selected{% endif %}>Proof of Income</option>
                <option value="other" {% if document.document_type == "other" %}selected{% endif %}>Other</option>
            </select>
        </div>
        <div class="row mb-5">
            <h4 class="mb-2 upload-title"><strong>Notes (Optional)</strong></h4>
            <div class="input-group shadow-sm w-75">
                <textarea class="form-control form-control-sm" name="document_notes" rows="4"
                            placeholder="Enter a short note or comment about the document (optional)">{{ document.document_notes or '' }}</textarea>
            </div>
        </div>

        <!-- Practitioner Name and Expiration Date -->
        <div class="row mb-5">
            <h4 class="upload-title practitioner"><strong>Expiration Date (Optional)</strong></h4>
            <div class="d-flex align-items-center mb-2">
                <input class="form-check-input me-2 custom-checkbox" type="checkbox" id="enableExpirationDate"
                        {% if document.expiration_date %}checked{% endif %}>
                <label class="form-check-label upload-title mb-0 me-3" for="enableExpirationDate"></label>
                <input type="date" class="form-control form-control-sm shadow-sm w-75" id="expirationDateField"
                        name="expiration_date"
                        value="{{ document.expiration_date.strftime('%Y-%m-%d') if document.expiration_date else '' }}"
                        {% if not document.expiration_date %}disabled{% endif %}>
            </div>
        </div>

        <!-- Buttons -->
        <div class="row mb-3">
                <button class="btn btn-upload shadow-sm w-75 mt-4" type="submit">Submit Changes</button>
                <div class="d-flex justify-content-center mt-3 mb-2">
                    <a href="{{ url_for('main.medical_document') }}" class="btn btn-outline-danger w-25">Cancel</a>
                </div>
        </div>

    </form>
</div>

<!-- Enable/Disable Expiration Date Script -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById("enableExpirationDate");
        const expirationField = document.getElementById("expirationDateField");

        checkbox.addEventListener("change", function () {
            expirationField.disabled = !this.checked;
        });
    });
</script>

{% endblock %}
